<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mealify Recipe Finder</title>
    
    <!-- Load React, ReactDOM, and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* --- GLOBAL STYLES --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        :root {
            --color-primary: #ef4444; /* red-500 */
            --color-secondary: #dc2626; /* red-600 */
            --color-bg-light: #f5f5f5; /* gray-50 */
            --color-card-light: #ffffff; /* white */
            --color-text-light: #1f2937; /* gray-800 */
            --color-shadow: rgba(0, 0, 0, 0.1);
            --color-border: #d1d5db; /* gray-300 */
            --color-accent: #facc15; /* yellow-400 */
        }
        
        .dark-mode {
            --color-primary: #ef4444;
            --color-secondary: #dc2626;
            --color-bg-dark: #111827; /* gray-900 */
            --color-card-dark: #374151; /* gray-700 */
            --color-text-dark: #f9fafb; /* gray-50 */
            --color-shadow: rgba(255, 255, 255, 0.1);
            --color-border: #4b5563; /* gray-600 */
        }

        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            padding: 0; 
            min-height: 100vh; 
            background-color: var(--color-bg-light);
            transition: background-color 0.3s;
        }
        
        .dark-mode body,
        .dark-mode .app-container {
            background-color: var(--color-bg-dark);
        }
        
        .dark-mode * {
            color: var(--color-text-dark);
        }
        
        /* Reset for the dark theme text */
        .dark-mode .text-red-600,
        .dark-mode .text-red-500 {
            color: var(--color-primary);
        }

        /* --- UTILITY CLASSES --- */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .space-x-2 > * + *, .space-x-3 > * + * { margin-left: 0.5rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .p-4 { padding: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .font-bold { font-weight: 700; }
        .font-extrabold { font-weight: 800; }
        .transition-colors { transition: background-color 0.3s, color 0.3s; }
        .min-h-screen { min-height: 100vh; }
        
        /* --- HEADER --- */
        .header {
            background-color: var(--color-primary);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .dark-mode .header {
            background-color: #1f2937; /* gray-800 */
        }
        .header-logo-text { color: var(--color-card-light); }
        .dark-mode .header-logo-text { color: var(--color-text-dark); }
        .header-button {
            padding: 0.5rem;
            border-radius: 9999px;
            cursor: pointer;
            border: none;
            position: relative;
            background-color: var(--color-secondary);
            color: var(--color-card-light);
            transition: transform 0.2s;
        }
        .dark-mode .header-button {
            background-color: #374151; /* gray-700 */
            color: var(--color-text-dark);
        }
        .header-button:hover {
            opacity: 0.9;
        }

        /* --- SEARCH BAR --- */
        /* --- SEARCH BAR --- */
.search-form { 
    gap: 4.75rem; 
    /* NEW: Allow elements to wrap to the next line if space runs out */
    flex-wrap: wrap; 
}
        .search-input-group { position: relative; flex-grow: 1; }
        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1.25rem;
            height: 1.25rem;
            color: #6b7280; /* gray-500 */
        }
        .dark-mode .search-icon { color: #9ca3af; /* gray-400 */ }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.2s;
            background-color: var(--color-card-light);
            color: var(--color-text-light);
        }
        .search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.5); /* ring-red-500 */
        }
        .dark-mode .search-input {
            background-color: #374151; /* gray-700 */
            border-color: #4b5563; /* gray-600 */
        }
        .search-button {
            background-color: var(--color-secondary);
            color: var(--color-card-light);
            font-weight: 600;
            border-radius: 0.75rem;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }
        .search-button:hover {
            background-color: #b91c1c; /* red-700 */
        }

        /* --- RECIPE CARD --- */
        .card-container {
            display: flex;
            flex-wrap: wrap;
            margin: -0.75rem; /* compensates for p-3 on children */
        }
        .card-wrapper {
            width: 100%; /* Default for mobile */
            padding: 0.75rem;
            box-sizing: border-box;
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .card-wrapper { width: 50%; }
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            .card-wrapper { width: 25%; }
        }

        .recipe-card {
            position: relative;
            background-color: var(--color-card-light);
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px var(--color-shadow);
            transition: all 0.3s;
            transform: scale(1);
        }
        .recipe-card:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(239, 68, 68, 0.3);
        }
        .dark-mode .recipe-card {
            background-color: #374151; /* gray-700 */
            box-shadow: 0 10px 15px -3px rgba(255, 255, 255, 0.1);
        }

        .card-image-wrapper { height: 12rem; cursor: pointer; }
        .card-image { width: 100%; height: 100%; object-fit: cover; }
        .card-content { padding: 1rem; }
        .card-title { font-size: 1.125rem; font-weight: 700; margin-bottom: 0.25rem; }
        .card-category { font-size: 0.875rem; opacity: 0.7; }

        .card-fav-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.5rem;
            background-color: white;
            border-radius: 9999px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 10;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }
        .card-fav-button:hover { transform: scale(1.1); }
        .fav-icon-color { color: #6b7280; } /* gray-500 */
        .dark-mode .fav-icon-color { color: #9ca3af; /* gray-400 */ }
        .fav-icon-filled { fill: var(--color-primary); color: var(--color-primary); }

        /* --- DETAIL VIEW --- */
        .detail-container { min-height: 100vh; padding: 1rem; }
        .detail-back-button {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            border: 1px solid var(--color-border);
            background-color: var(--color-card-light);
            color: var(--color-text-light);
            transition: all 0.2s;
        }
        .detail-back-button:hover { background-color: #f3f4f6; } /* gray-100 */
        .dark-mode .detail-back-button {
            background-color: #374151; /* gray-700 */
            color: var(--color-text-dark);
            border-color: #4b5563;
        }
        .dark-mode .detail-back-button:hover { background-color: #4b5563; } /* gray-600 */
        
        .detail-card {
            background-color: var(--color-card-light);
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
        .dark-mode .detail-card { background-color: #1f2937; } /* gray-800 */

        .detail-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
        .detail-title { font-size: 2.25rem; font-weight: 800; color: var(--color-primary); }
        
        .detail-image-section { margin-right: 1.5rem; }
        .detail-image { width: 100%; height: 24rem; object-fit: cover; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); margin-bottom: 1rem; }
        
        .detail-tags { display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.875rem; }
        .tag-primary { padding: 0.25rem 0.75rem; background-color: var(--color-primary); color: white; font-weight: 500; border-radius: 9999px; }
        .tag-secondary { padding: 0.25rem 0.75rem; background-color: #fee2e2; /* red-100 */ color: #b91c1c; /* red-700 */ font-weight: 500; border-radius: 9999px; }
        .tag-default { padding: 0.25rem 0.75rem; background-color: #e5e7eb; /* gray-200 */ color: #374151; /* gray-700 */ border-radius: 9999px; }

        .detail-section-title { font-size: 1.5rem; font-weight: 700; margin-top: 1rem; margin-bottom: 0.75rem; padding-bottom: 0.25rem; border-bottom: 1px solid #eee; }
        .detail-ingredients-list { list-style: disc; padding-left: 1.25rem; margin: 0; }
        .detail-ingredients-list li { margin-bottom: 0.5rem; font-size: 1.125rem; }
        .ingredient-measure { font-weight: 600; color: var(--color-primary); }
        .detail-instructions { white-space: pre-wrap; font-size: 1.125rem; line-height: 1.6; }

        @media (min-width: 1024px) { /* lg breakpoint */
            .detail-layout { display: flex; gap: 1.5rem; }
            .detail-layout > div { flex: 1; }
        }

        /* --- MESSAGING / UTILITY --- */
        .message-box {
            padding: 2rem;
            text-align: center;
            border-radius: 0.75rem;
            margin: 2.5rem auto;
            max-width: 32rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .empty-state { color: #9ca3af; }
        .error-message { background-color: #fee2e2; color: #991b1b; } /* red-100, red-800 */
        .dark-mode .error-message { background-color: #7f1d1d; color: white; } /* red-900 */
        
        .spinner-icon {
            animation: spin 1s linear infinite;
            color: var(--color-primary);
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="font-inter">
    <div id="root"></div>

    <script type="text/babel">
        // --- REACT & ICON SETUP ---
        const { useState, useEffect, useCallback, useMemo } = React;

        // Custom Icon components (using inline SVG paths) to replace lucide-react
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={path}/></svg>
        );
        const Search = (props) => <Icon {...props} path="M21 21l-6.5-6.5M10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14z" />;
        const Heart = (props) => <Icon {...props} path="M20.84 4.84a5.5 5.5 0 0 0-7.78 0L12 5.89l-1.06-1.05a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />;
        const Utensils = (props) => <Icon {...props} path="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M9 11h6a2 2 0 0 0 2-2V2M3 11v11M21 21l-10-10" />;
        const Sun = (props) => <Icon {...props} path="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12z" />;
        const Moon = (props) => <Icon {...props} path="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9z" />;
        const X = (props) => <Icon {...props} path="M18 6L6 18M6 6l12 12" />;
        const Loader2 = (props) => <Icon {...props} path="M21 12a9 9 0 0 0-9-9 9 9 0 0 0-9 9m9-9v2M12 22v-2" />;
        
        // --- CONSTANTS AND API FUNCTIONS ---
        
        const MEAL_API_BASE_URL = 'https://www.themealdb.com/api/json/v1/1';

        const VIEWS = {
          HOME: 'home',
          DETAIL: 'detail',
          FAVORITES: 'favorites',
        };

        const THEMES = {
          LIGHT: 'light',
          DARK: 'dark',
        };

        /**
         * Searches for meals by name.
         * @param {string} query
         */
        const searchMeals = async (query) => {
          if (!query) return [];
          try {
            const response = await fetch(`${MEAL_API_BASE_URL}/search.php?s=${query}`);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            return data.meals || [];
          } catch (error) {
            console.error("Error searching meals:", error);
            throw new Error("Failed to fetch recipes. Check your connection.");
          }
        };

        /**
         * Looks up a single meal by ID.
         * @param {string} id
         */
        const lookupMeal = async (id) => {
          if (!id) return null;
          try {
            const response = await fetch(`${MEAL_API_BASE_URL}/lookup.php?i=${id}`);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            return data.meals ? data.meals[0] : null;
          } catch (error) {
            console.error("Error looking up meal:", error);
            throw new Error("Failed to fetch recipe details.");
          }
        };

        /**
         * Utility to parse ingredients from the massive meal object.
         * @param {object} mealData
         */
        const getIngredients = (mealData) => {
          const ingredients = [];
          for (let i = 1; i <= 20; i++) {
            const ingredient = mealData[`strIngredient${i}`];
            const measure = mealData[`strMeasure${i}`];

            if (ingredient && ingredient.trim() && measure && measure.trim()) {
              ingredients.push({ ingredient: ingredient.trim(), measure: measure.trim() });
            }
          }
          return ingredients;
        };

        // --- HOOKS ---

        /**
         * Hook for managing state persistence using localStorage.
         * @param {string} key
         * @param {any} initialValue
         */
        const useLocalStorage = (key, initialValue) => {
          const [storedValue, setStoredValue] = useState(() => {
            try {
              const item = window.localStorage.getItem(key);
              return item ? JSON.parse(item) : initialValue;
            } catch (error) {
              console.error(error);
              return initialValue;
            }
          });

          const setValue = (value) => {
            try {
              const valueToStore = value instanceof Function ? value(storedValue) : value;
              setStoredValue(valueToStore);
              window.localStorage.setItem(key, JSON.stringify(valueToStore));
            } catch (error) {
              console.error(error);
            }
          };
          return [storedValue, setValue];
        };

        // --- COMPONENTS ---

        const Header = ({ setView, theme, toggleTheme, favoritesCount }) => {
          const isDark = theme === THEMES.DARK;
          const iconColor = isDark ? 'text-yellow-400' : 'text-gray-700';
          const heartFill = isDark ? 'white' : 'white';

          return (
            <header className={`header flex justify-between items-center p-4 transition-colors ${isDark ? 'dark-mode' : ''}`}>
              <div className="flex items-center space-x-2 cursor-pointer" onClick={() => setView(VIEWS.HOME)}>
                <Utensils size={32} className="header-logo-text" />
                <h1 className="text-3xl font-extrabold header-logo-text">Mealify</h1>
              </div>

              <nav className="flex items-center space-x-3">
                <button
                  className={`header-button ${isDark ? 'dark-mode' : ''}`}
                  onClick={() => setView(VIEWS.FAVORITES)}
                  aria-label="View Favorites"
                >
                  <Heart fill={heartFill} size={24} className={isDark ? 'text-white' : 'text-white'} />
                  {favoritesCount > 0 && (
                    <span style={{ 
                        position: 'absolute', top: '-4px', right: '-4px', 
                        backgroundColor: 'var(--color-accent)', color: '#1f2937', 
                        fontSize: '0.75rem', fontWeight: 'bold', 
                        width: '20px', height: '20px', borderRadius: '50%', 
                        display: 'flex', alignItems: 'center', justifyContent: 'center' 
                    }}>
                      {favoritesCount}
                    </span>
                  )}
                </button>

                <button
                  className={`header-button ${isDark ? 'dark-mode' : ''}`}
                  onClick={toggleTheme}
                  aria-label="Toggle Theme"
                >
                  {isDark ? <Sun size={24} className={iconColor} /> : <Moon size={24} style={{ color: 'white' }} />}
                </button>
              </nav>
            </header>
          );
        };

        const SearchBar = ({ searchQuery, setSearchQuery, handleSearch, isDark }) => {
          const inputClass = isDark ? 'dark-mode' : '';

          return (
            <form onSubmit={(e) => { e.preventDefault(); handleSearch(); }} className="p-4 flex search-form">
              <div className="search-input-group">
                <Search className="search-icon" size={20} />
                <input
                  type="text"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  placeholder="Search for a meal (e.g., Beef, Chicken, Pasta)"
                  className={`search-input ${inputClass}`}
                />
              </div>
              <button
                type="submit"
                className="px-6 py-3 search-button font-semibold"
                aria-label="Search"
              >
                <Search size={24} style={{ fill: 'white' }} />
              </button>
            </form>
          );
        };

        const RecipeCard = ({ meal, onClick, isDark, toggleFavorite, isFavorite }) => {
          const cardClass = isDark ? 'dark-mode' : '';
          const heartClass = isFavorite ? 'fav-icon-filled' : (isDark ? 'fav-icon-color dark-mode' : 'fav-icon-color');

          return (
            <div className="card-wrapper">
              <div className={`recipe-card ${cardClass}`}>
                <div className="card-image-wrapper" onClick={() => onClick(meal.idMeal)}>
                  <img
                    src={meal.strMealThumb}
                    alt={meal.strMeal}
                    className="card-image"
                    onError={(e) => e.target.src = `https://placehold.co/400x300/FEE2E2/B91C1C?text=Mealify`}
                  />
                </div>
                <div className="card-content">
                  <h3 className="card-title">{meal.strMeal}</h3>
                  <p className="card-category">{meal.strCategory} | {meal.strArea}</p>
                </div>
                <button
                  className="card-fav-button"
                  onClick={() => toggleFavorite(meal)}
                  aria-label={isFavorite ? "Remove from Favorites" : "Add to Favorites"}
                >
                  <Heart size={20} className={heartClass} />
                </button>
              </div>
            </div>
          );
        };

        const DetailView = ({ mealId, setView, isDark, toggleFavorite, isFavorite }) => {
          const [meal, setMeal] = useState(null);
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState(null);

          useEffect(() => {
            const fetchDetails = async () => {
              setLoading(true);
              setError(null);
              try {
                const mealData = await lookupMeal(mealId);
                if (mealData) {
                  setMeal(mealData);
                } else {
                  setError("Recipe details could not be found.");
                }
              } catch (err) {
                setError(err.message);
              } finally {
                setLoading(false);
              }
            };
            fetchDetails();
          }, [mealId]);

          const ingredients = useMemo(() => meal ? getIngredients(meal) : [], [meal]);
          const detailClass = isDark ? 'dark-mode' : '';
          const heartClass = isFavorite(mealId) ? 'fav-icon-filled' : (isDark ? 'fav-icon-color dark-mode' : 'fav-icon-color');

          if (loading) return <LoadingSpinner message="Loading Recipe Details..." isDark={isDark} />;
          if (error) return <ErrorMessage message={error} isDark={isDark} />;
          if (!meal) return <ErrorMessage message="Recipe not found." isDark={isDark} />;

          return (
            <div className={`detail-container ${detailClass}`}>
              <button
                onClick={() => setView(VIEWS.HOME)}
                className="detail-back-button"
              >
                <X size={20} style={{ marginRight: '0.25rem' }} />
                Back to Search
              </button>

              <div className="detail-card">
                <div className="detail-header">
                    <h2 className="detail-title">{meal.strMeal}</h2>
                    <button
                        style={{ padding: '0.75rem', backgroundColor: '#fee2e2', borderRadius: '50%', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)', border: 'none', transition: 'transform 0.2s', cursor: 'pointer' }}
                        onClick={() => toggleFavorite(meal)}
                        aria-label={isFavorite(mealId) ? "Remove from Favorites" : "Add to Favorites"}
                    >
                        <Heart size={28} className={heartClass} />
                    </button>
                </div>
                
                <div className="detail-layout">
                  <div style={{ flex: 1 }}>
                    <img
                      src={meal.strMealThumb}
                      alt={meal.strMeal}
                      className="detail-image"
                      onError={(e) => e.target.src = `https://placehold.co/600x400/FEE2E2/B91C1C?text=Meal+Image`}
                    />
                    <div className="detail-tags">
                        <span className="tag-primary">
                            {meal.strCategory}
                        </span>
                        <span className="tag-secondary">
                            {meal.strArea}
                        </span>
                        {meal.strTags && meal.strTags.split(',').map((tag, index) => (
                            <span key={index} className="tag-default">{tag.trim()}</span>
                        ))}
                    </div>
                  </div>
                  
                  <div style={{ flex: 1 }}>
                    <h3 className="detail-section-title">Ingredients</h3>
                    <ul className="detail-ingredients-list">
                      {ingredients.map((item, index) => (
                        <li key={index} style={{ fontSize: '1.125rem' }}>
                          <span className="ingredient-measure">{item.measure}</span> of {item.ingredient}
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>
                
                <h3 className="detail-section-title" style={{ marginTop: '2rem' }}>Instructions</h3>
                <p className="detail-instructions">{meal.strInstructions}</p>
              </div>
            </div>
          );
        };

        const ErrorMessage = ({ message, isDark }) => (
          <div className={`message-box error-message ${isDark ? 'dark-mode' : ''}`}>
            <X size={40} style={{ margin: '0 auto 1rem', display: 'block' }} />
            <h3 className="text-xl font-bold" style={{ fontSize: '1.25rem', fontWeight: 700, marginBottom: '0.5rem' }}>Operation Failed</h3>
            <p>{message}</p>
          </div>
        );

        const LoadingSpinner = ({ message, isDark }) => (
          <div className={`flex flex-col items-center justify-center p-4 ${isDark ? 'dark-mode' : ''}`} style={{ padding: '2.5rem', alignItems: 'center', justifyContent: 'center' }}>
            <Loader2 size={48} className="spinner-icon" />
            <p style={{ fontSize: '1.125rem', fontWeight: 500, marginTop: '1rem' }}>{message}</p>
          </div>
        );

        const EmptyState = ({ message, icon: Icon, isDark }) => (
          <div className={`message-box empty-state ${isDark ? 'dark-mode' : ''}`} style={{ boxShadow: 'none' }}>
            <Icon size={64} style={{ margin: '0 auto 1rem', display: 'block', opacity: 0.7 }} />
            <h3 className="text-xl font-bold" style={{ fontSize: '1.25rem', fontWeight: 700, marginBottom: '0.5rem' }}>{message}</h3>
          </div>
        );

        // --- MAIN APP COMPONENT ---

        const App = () => {
          // State for navigation/routing
          const [currentView, setCurrentView] = useState(VIEWS.HOME);
          const [currentMealId, setCurrentMealId] = useState(null);

          // State for search and results
          const [searchQuery, setSearchQuery] = useState('');
          const [searchResults, setSearchResults] = useState([]);
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);

          // Bonus Feature: Theme Toggle
          const [theme, setTheme] = useLocalStorage('mealifyTheme', THEMES.LIGHT);
          const isDark = theme === THEMES.DARK;
          const toggleTheme = () => setTheme(prev => prev === THEMES.LIGHT ? THEMES.DARK : THEMES.LIGHT);

          // Bonus Feature: Favorites
          const [favorites, setFavorites] = useLocalStorage('mealifyFavorites', []);
          const favoriteMeals = useMemo(() => {
            return favorites.map(f => f.meal);
          }, [favorites]);

          const isFavorite = useCallback((mealId) => {
            return favorites.some(f => f.id === mealId);
          }, [favorites]);

          const toggleFavorite = useCallback((meal) => {
            const mealId = meal.idMeal || meal.id;
            setFavorites(prev => {
              if (isFavorite(mealId)) {
                // Remove favorite
                return prev.filter(f => f.id !== mealId);
              } else {
                // Add favorite
                const mealToSave = {
                  id: mealId,
                  meal: {
                    idMeal: mealId,
                    strMeal: meal.strMeal,
                    strMealThumb: meal.strMealThumb,
                    strCategory: meal.strCategory,
                    strArea: meal.strArea,
                  }
                };
                return [...prev, mealToSave];
              }
            });
          }, [isFavorite, setFavorites]);
          
          // --- Search Logic ---
          const handleSearch = useCallback(async () => {
            if (!searchQuery.trim()) return;
            setLoading(true);
            setError(null);
            setSearchResults([]);
            try {
              const results = await searchMeals(searchQuery);
              setSearchResults(results);
            } catch (e) {
              setError(e.message);
            } finally {
              setLoading(false);
            }
          }, [searchQuery]);

          // --- Rendering Logic ---

          const renderContent = () => {
            if (currentView === VIEWS.DETAIL && currentMealId) {
              return (
                <DetailView
                  mealId={currentMealId}
                  setView={setCurrentView}
                  isDark={isDark}
                  toggleFavorite={toggleFavorite}
                  isFavorite={isFavorite}
                />
              );
            }

            if (currentView === VIEWS.FAVORITES) {
              if (favoriteMeals.length === 0) {
                return <EmptyState message="You haven't saved any favorite recipes yet!" icon={Heart} isDark={isDark} />;
              }
              return (
                <div className={`detail-container ${isDark ? 'dark-mode' : ''}`} style={{ minHeight: '100vh', padding: '1.5rem' }}>
                    <h2 style={{ fontSize: '1.875rem', fontWeight: 700, marginBottom: '1.5rem', color: 'var(--color-primary)' }}>
                        Your Saved Recipes ({favorites.length})
                    </h2>
                    <div className="card-container">
                    {favoriteMeals.map(meal => (
                        <RecipeCard
                        key={meal.idMeal}
                        meal={meal}
                        onClick={(id) => { setCurrentMealId(id); setCurrentView(VIEWS.DETAIL); }}
                        isDark={isDark}
                        toggleFavorite={toggleFavorite}
                        isFavorite={() => true} // Always true for the favorites list
                        />
                    ))}
                    </div>
                </div>
              );
            }

            // Default to VIEWS.HOME
            return (
              <main className={`${isDark ? 'dark-mode' : ''}`} style={{ minHeight: '100vh' }}>
                <SearchBar
                  searchQuery={searchQuery}
                  setSearchQuery={setSearchQuery}
                  handleSearch={handleSearch}
                  isDark={isDark}
                />

                {loading && <LoadingSpinner message="Searching for recipes..." isDark={isDark} />}
                {error && <ErrorMessage message={error} isDark={isDark} />}

                {!loading && !error && searchResults.length === 0 && searchQuery.trim() && (
                  <EmptyState message={`No recipes found for "${searchQuery}".`} icon={X} isDark={isDark} />
                )}

                {!loading && !error && searchResults.length === 0 && !searchQuery.trim() && (
                  <EmptyState message="Start by searching for a cuisine or ingredient above!" icon={Utensils} isDark={isDark} />
                )}

                {!loading && searchResults.length > 0 && (
                  <div style={{ padding: '1rem' }}>
                    <h2 style={{ fontSize: '1.25rem', fontWeight: 600, marginBottom: '1rem', color: isDark ? 'white' : '#4b5563' }}>
                        Showing {searchResults.length} results for "{searchQuery}"
                    </h2>
                    <div className="card-container">
                      {searchResults.map(meal => (
                        <RecipeCard
                          key={meal.idMeal}
                          meal={meal}
                          onClick={(id) => { setCurrentMealId(id); setCurrentView(VIEWS.DETAIL); }}
                          isDark={isDark}
                          toggleFavorite={toggleFavorite}
                          isFavorite={() => isFavorite(meal.idMeal)}
                        />
                      ))}
                    </div>
                  </div>
                )}
              </main>
            );
          };

          return (
            <div className={`app-container ${isDark ? 'dark-mode' : ''} font-inter`} style={{ minHeight: '100vh' }}>
              {/* Optional custom scrollbar style for better aesthetics */}
              <style>{`
                ::-webkit-scrollbar { width: 8px; }
                ::-webkit-scrollbar-track { background: ${isDark ? '#4b5563' : '#f1f1f1'}; }
                ::-webkit-scrollbar-thumb { background: #ef4444; border-radius: 4px; }
                ::-webkit-scrollbar-thumb:hover { background: #dc2626; }
              `}</style>
              <Header
                currentView={currentView}
                setView={setCurrentView}
                theme={theme}
                toggleTheme={toggleTheme}
                favoritesCount={favorites.length}
              />
              {renderContent()}
            </div>
          );
        };

        // Render the main App component to the root element
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>